<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Single Page Apps for GitHub Pages</title>
    <script type="text/javascript">
      // Single Page Apps for GitHub Pages
      // MIT License
      // https://github.com/rafgraph/spa-github-pages
      // This script takes the current url and converts the path and query
      // string into just a query string, and then redirects the browser
      // to the new url with only a query string and hash fragment,
      // e.g. https://www.foo.tld/one/two?a=b&c=d#qwe, becomes
      // https://www.foo.tld/?/one/two&a=b~and~c=d#qwe
      // Note: this 404.html file must be at least 512 bytes for it to work
      // with Internet Explorer (it is currently > 512 bytes)

      // If you're creating a Project Pages site and NOT using a custom domain,
      // then set pathSegmentsToKeep to 1 (enterprise users may need to set it to > 1).
      // This way the code will only replace the route part of the path, and not
      // the real directory in which the app resides, for example:
      // https://username.github.io/repo-name/one/two?a=b&c=d#qwe becomes
      // https://username.github.io/repo-name/?/one/two&a=b~and~c=d#qwe
      // Otherwise, leave pathSegmentsToKeep as 0.
      // 配置项
      // 配置项
      const config = {
        pathSegmentsToKeep: 2, // 项目页面的目录深度
        paramSeparator: "~and~", // 参数分隔符
      };

      // 获取当前URL相关信息
      const pathname = window.location.pathname;
      const search = window.location.search;
      const pathSegments = pathname.split("/").filter((segment) => segment);

      // 检查是否已经在重定向后的URL格式，避免无限循环
      if (
        search.startsWith("?/") ||
        pathSegments.length <= config.pathSegmentsToKeep
      ) {
        // 如果已经是目标格式或路径段不足，直接退出
        document.body.innerHTML = "<h1>404 - Page Not Found</h1>";
      } else {
        // 分割基础路径和路由路径
        const basePath = pathSegments
          .slice(0, config.pathSegmentsToKeep)
          .join("/");
        const routePath = pathSegments
          .slice(config.pathSegmentsToKeep)
          .join("/");

        // 构建新的查询字符串
        const newSearch = [
          routePath ? `/${routePath}` : "",
          search ? search.slice(1) : "",
        ]
          .filter(Boolean)
          .join("&")
          .replace(/&/g, config.paramSeparator);

        // 重定向到新URL
        const newUrl = `${window.location.protocol}//${window.location.hostname}${
          window.location.port ? ":" + window.location.port : ""
        }/${basePath}/?${newSearch}${window.location.hash}`;

        window.location.replace(newUrl);
      }
    </script>
  </head>
  <body></body>
</html>
